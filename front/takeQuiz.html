<html>

<head>
<link rel="stylesheet" type="text/css" href="style.css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body>

  <div class="menu">
    <i type="button" style="float: left" value="Back" class="material-icons md-48" id="backButton">arrow_back</i>
    <p style="width:50%; margin-right:60px; margin-top:5px" id="menu_text"> Quiz 1 </p>
  </div>

  <div class="widePage" id="page">
    <div class="card" style="padding: 1px;">
      <h1 style="text-align: center;"> Quiz 1 </h1>
    </div>

    <input type="hidden" name="input" value="hello">
    <button onclick="getAnswers()" class="popup"> Submit </button>

  </div>

  <script>

  var back = document.getElementById("backButton");
  back.onclick = function(event) {
      window.location.href = 'student.html';
    };

  //start
  var data = "request=gettest";

  // construct an HTTP request
  var xhr = new XMLHttpRequest();
  url = "https://web.njit.edu/~ybp7/CS490/middle.php";
  xhr.open("post", url, true);
  xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

  // send the collected data as JSON
  xhr.send(data);

  xhr.onreadystatechange = function() {
    if (xhr.readyState == XMLHttpRequest.DONE) {
        console.log("returned data: ");
        var ret = xhr.responseText;
        console.log(xhr.responseText);
        if(ret == "not started") {
          window.location.href = 'student.html?message=Test_not_released_yet';
          return;
        }
        generatePage(xhr.responseText);
    }
  };

  //get check values
  function getAnswers() {
    var ids = document.getElementsByName('id');
    var answers = document.getElementsByName('answer');

    var data = "request=submittest&";
    for(var i = 0; i < ids.length; i++) {
      data += "question_id" + (i+1) + "=" + ids[i].value + "&";
      data += "answer" + (i+1) + "=" + encodeURIComponent(answers[i].value) + "&";
    }

    console.log("data sent: " + data);

    var xhr = new XMLHttpRequest();
    url = "https://web.njit.edu/~ybp7/CS490/middle.php";
    xhr.open("post", url, true);
    xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

    // send the collected data
    xhr.send(data);

    xhr.onreadystatechange = function() {
      if (xhr.readyState == XMLHttpRequest.DONE) {
          console.log("received: ");
          console.log(xhr.responseText);
          window.location.href = 'student.html?message=Test_has_been_submitted';
      }
    };
  }

  function generatePage(rawJSON) {

    var html = "";

    var json = JSON.parse(xhr.responseText);
    console.log(json);
    var counter = 0;

    json.forEach(function(entry) {
      var params = JSON.parse(entry['parameters']);
      counter++;

      html += "<div class=\"card\">" +
      "<input type=\"hidden\" name=\"id\" value="+entry['question_id']+" />" +
      "<h2> Problem " + counter + " </h2>"+
        "<p> Write a method called <b>" + entry['method_name'] + "</b>";

      if(params['paramName'] != "") {
        html += " that takes the following parameter(s):<br>"

        var pNames = params['paramName'].split(",");
        var pTypes = params['paramType'].split(",");

        for(var i = 0; i < pNames.length; i++) {
          html += "<b>" + pTypes[i] + " ";
          html += pNames[i] + "</b><br>";
        }
      }

      html += "</p> <p> <br>" + entry['description'] + " </p> <br>";

      html += "<form><textarea name=\"answer\" cols=\"40\" rows=\"5\" placeholder=\"code here\" required></textarea></form>";


          html += "<p> It should handle the following test case(s): </p>";


        var testCases = entry['testcases'];
        if(testCases != "") {
          testCases = JSON.parse(testCases);
          for(var i = 0; i < testCases.length; i++) {
            html += "<p> <b> Input: " + testCases[i]['inputs'] + " Output: " + testCases[i]['output'] + " </b> </p>";
          }
        }
      html += "</div>";
    });

    html += "<button onclick=\"getAnswers()\" class=\"popup\"> Submit </button>";

    var page = document.getElementById('page');
    page.innerHTML = html;
  }



  </script>
</body>
</html>
